<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cloudok.bbs.mapper.PostMapper">
	<update id="customUpdate" parameterType="com.cloudok.bbs.po.PostPO">
		update bbs_post set  content = #{content}, attach_ids=#{attachIds}
		<where>
			<include refid="com.cloudok.core.mybatis.BaseMapper.byId"/>
		</where>
	</update>
	<select id="searchByTopic"
		parameterType="Map"
		resultMap="postMap">
		select
		<include refid="columns"></include>
		from bbs_post  t inner join bbs_post_topic pt on t.id = pt.post_id and pt.deleted=false and t.deleted=false
		<if test="topicList != null">
			and pt.topic_id in 
			<foreach collection="topicIdList" close=")" item="item" open="(" separator=",">
				#{item}
			</foreach>
		</if>
		
		limit #{start},#{end}
		 
	</select>

	<select id="searchByTopicCount"
		parameterType="Map"
		resultType="long">
		select count(1)
			from bbs_post  t inner join bbs_post_topic pt on t.id = pt.post_id and pt.deleted=false and t.deleted=false
		<if test="topicList != null">
			and pt.topic_id in 
			<foreach collection="topicIdList" close=")" item="item" open="(" separator=",">
				#{item}
			</foreach>
		</if>
	</select>
	
	<select id="getMyCollectPosts"
		parameterType="Map"
		resultMap="postMap">
		select
		<include refid="columns"></include>
		from bbs_post  t inner join bbs_collect pt on t.id = pt.business_id and pt.deleted=false and t.deleted=false and pt.create_by = #{memberId}
		limit #{start},#{end}
		 
	</select>

	<select id="getMyCollectPostsCount"
		parameterType="Map"
		resultType="long">
		select count(1)
			from bbs_post  t inner join bbs_collect pt on t.id = pt.business_id and pt.deleted=false and t.deleted=false and pt.create_by = #{memberId}
		 
	</select>
</mapper>